{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelSelect as _vModelSelect, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-ab905f6e\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"vote-page\"\n};\nconst _hoisted_2 = {\n  key: 0\n};\nconst _hoisted_3 = {\n  class: \"vote-form\"\n};\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"option\", {\n  value: \"\",\n  disabled: \"\"\n}, \"请选择\", -1 /* HOISTED */));\nconst _hoisted_6 = [\"value\"];\nconst _hoisted_7 = [\"disabled\"];\nconst _hoisted_8 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$data.selectedVoteType ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createCommentVNode(\" 选了类型才能投 selectedCampaignName\"), _createElementVNode(\"h2\", null, \"请为你喜欢的\" + _toDisplayString($data.voteTypeMap[$data.selectedVoteType]) + \"投票\", 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_3, [_withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.selectedOption = $event),\n    disabled: $data.hasVoted[$data.selectedVoteType],\n    class: \"vote-select\"\n  }, [_hoisted_5, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.options, option => {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: option.id,\n      value: option.id\n    }, _toDisplayString(option.name), 9 /* TEXT, PROPS */, _hoisted_6);\n  }), 128 /* KEYED_FRAGMENT */))], 8 /* PROPS */, _hoisted_4), [[_vModelSelect, $data.selectedOption]]), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.submitVote && $options.submitVote(...args)),\n    disabled: $data.hasVoted[$data.selectedVoteType],\n    class: \"vote-button\"\n  }, \"Vote\", 8 /* PROPS */, _hoisted_7)]), $data.hasVoted[$data.selectedVoteType] ? (_openBlock(), _createElementBlock(\"p\", _hoisted_8, \"您已为 \" + _toDisplayString($data.voteTypeMap[$data.selectedVoteType]) + \" 投票,选项为:\" + _toDisplayString($data.selectedOptionName[$data.selectedVoteType]), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","key","_createElementVNode","value","disabled","_createElementBlock","_hoisted_1","$data","selectedVoteType","_hoisted_2","_createCommentVNode","_toDisplayString","voteTypeMap","_hoisted_3","_cache","$event","selectedOption","hasVoted","_hoisted_5","_Fragment","_renderList","options","option","id","name","_hoisted_6","_hoisted_4","onClick","args","$options","submitVote","_hoisted_7","_hoisted_8","selectedOptionName"],"sources":["/Users/wangxiao/voting_front/src/components/VotePage.vue"],"sourcesContent":["<!-- VotePage.vue -->\n<template>\n  <div class=\"vote-page\">\n    <div v-if=\"selectedVoteType\"> <!-- 选了类型才能投 selectedCampaignName-->\n      <h2>请为你喜欢的{{ voteTypeMap[selectedVoteType] }}投票</h2>\n      <div class=\"vote-form\">\n        <select v-model=\"selectedOption\" :disabled=\"hasVoted[selectedVoteType]\" class=\"vote-select\">\n          <option value=\"\" disabled>请选择</option>\n          <option v-for=\"option in options\" :key=\"option.id\" :value=\"option.id\">\n            {{ option.name }}\n          </option>\n        </select>\n        <button @click=\"submitVote\" :disabled=\"hasVoted[selectedVoteType]\" class=\"vote-button\">Vote</button>\n      </div>\n      <p v-if=\"hasVoted[selectedVoteType]\">您已为 {{ voteTypeMap[selectedVoteType] }} 投票,选项为:{{ selectedOptionName[selectedVoteType] }}</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  data() {\n    return {\n      selectedVoteType: '', // 当前选择的投票类型\n      selectedOption: '', // 用户选定的投票选项\n      selectedCampaignId: '', // 当前活动的ID（未在模板中使用）\n      selectedCampaignName: '', // 当前投票活动的名称（未在模板中使用）\n      selectedOptionName: { // 存储每种投票类型的选项名称\n        project: '',\n        people: '',\n        product: ''\n      },\n      hasVoted: { // 标记用户是否已经投票\n        project: false,\n        people: false,\n        product: false\n      },\n      voteTypeMap: {  // 投票类型的映射表，用于界面显示\n        project: 'Project',\n        people: 'People',\n        product: 'Product'\n      },\n      options: []\n    };\n  },\n  computed: {\n    votedResult() { // 从根实例中获取已投票的结果\n      return this.$root.votedResult[this.selectedVoteType];\n    }\n  },\n  watch: {\n    '$route.params.type': {\n      immediate: true,\n      handler(newType) {\n        this.selectedVoteType = newType;\n        this.fetchOptions();\n        this.loadVotedResult();\n      }\n    }\n  },\n  methods: {\n    fetchOptions() {  // 从后端API获取选项\n      axios.get(`http://localhost:3000/api/options/${this.selectedVoteType}`)\n        .then(response => {\n          this.options = response.data;\n          //{ id: 1, name: 'Project 1', votes: 0 },\n          //{ id: 2, name: 'Project 2', votes: 0 },\n          //{ id: 3, name: 'Project 3', votes: 0 }\n        })\n        .catch(error => {\n          console.error(error);\n        });\n    },\n    loadVotedResult() { // 加载用户的投票结果\n      if (this.votedResult) {\n        //  已经投了\n        this.hasVoted[this.selectedVoteType] = true;\n        this.selectedOption = this.votedResult.selectedOption;\n        this.selectedOptionName[this.selectedVoteType] = this.votedResult.selectedOptionName;\n      } else {\n        // 没投\n        this.hasVoted[this.selectedVoteType] = false;\n        this.selectedOption = '';\n        this.selectedOptionName[this.selectedVoteType] = '';\n      }\n    },\n    submitVote() {\n      if (!this.selectedOption) {\n        alert(\"请选择一个选项\");\n        return;\n      }\n      axios.post(`http://localhost:3000/api/vote/${this.selectedVoteType}`, { selectedOption: this.selectedOption })\n        .then(() => { //成功投票后\n          this.hasVoted[this.selectedVoteType] = true;  //用户已经在该类别投票，用于禁用再次投票。\n          this.selectedOptionName[this.selectedVoteType] = this.options.find(option => option.id === this.selectedOption).name;\n          const result = {\n            voteType: this.selectedVoteType,\n            selectedOption: this.selectedOption,\n            selectedOptionName: this.selectedOptionName[this.selectedVoteType]\n          };\n          this.$emit('vote-submitted', result);\n        })\n        .catch(error => {\n          console.error(error);\n        });\n\n        console.log({\n              voteType: this.selectedVoteType,\n              selectedOption: this.selectedOption,\n              selectedOptionName: this.selectedOptionName[this.selectedVoteType]\n            });\n\n    }\n  }\n};\n</script>\n\n\n\n\n\n<style scoped>\n.vote-form {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.vote-select {\n  margin-bottom: 10px;\n  width: 200px;\n  padding: 8px;\n  font-size: 16px;\n}\n\n.vote-button {\n  background-color: #007bff;\n  color: #fff;\n  border: none;\n  padding: 10px 20px;\n  cursor: pointer;\n  font-size: 16px;\n}\n\n.vote-button:disabled {\n  background-color: #ccc;\n  cursor: not-allowed;\n}\n\nselect:disabled {\n  background-color: #f0f0f0;\n}\n</style>"],"mappings":";;;EAEOA,KAAK,EAAC;AAAW;;EAFxBC,GAAA;AAAA;;EAKWD,KAAK,EAAC;AAAW;mBAL5B;gEAOUE,mBAAA,CAAsC;EAA9BC,KAAK,EAAC,EAAE;EAACC,QAAQ,EAAR;GAAS,KAAG;mBAPvC;mBAAA;;EAAAH,GAAA;AAAA;;uBAEEI,mBAAA,CAcM,OAdNC,UAcM,GAbOC,KAAA,CAAAC,gBAAgB,I,cAA3BH,mBAAA,CAYM,OAfVI,UAAA,GAGkCC,mBAAA,iCAAoC,EAChER,mBAAA,CAAoD,YAAhD,QAAM,GAAAS,gBAAA,CAAGJ,KAAA,CAAAK,WAAW,CAACL,KAAA,CAAAC,gBAAgB,KAAI,IAAE,iBAC/CN,mBAAA,CAQM,OARNW,UAQM,G,gBAPJX,mBAAA,CAKS;IAXjB,uBAAAY,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAMyBR,KAAA,CAAAS,cAAc,GAAAD,MAAA;IAAGX,QAAQ,EAAEG,KAAA,CAAAU,QAAQ,CAACV,KAAA,CAAAC,gBAAgB;IAAGR,KAAK,EAAC;MAC5EkB,UAAsC,G,kBACtCb,mBAAA,CAESc,SAAA,QAVnBC,WAAA,CAQmCb,KAAA,CAAAc,OAAO,EAAjBC,MAAM;yBAArBjB,mBAAA,CAES;MAF0BJ,GAAG,EAAEqB,MAAM,CAACC,EAAE;MAAGpB,KAAK,EAAEmB,MAAM,CAACC;wBAC7DD,MAAM,CAACE,IAAI,wBAT1BC,UAAA;kDAAAC,UAAA,I,gBAMyBnB,KAAA,CAAAS,cAAc,E,GAM/Bd,mBAAA,CAAoG;IAA3FyB,OAAK,EAAAb,MAAA,QAAAA,MAAA,UAAAc,IAAA,KAAEC,QAAA,CAAAC,UAAA,IAAAD,QAAA,CAAAC,UAAA,IAAAF,IAAA,CAAU;IAAGxB,QAAQ,EAAEG,KAAA,CAAAU,QAAQ,CAACV,KAAA,CAAAC,gBAAgB;IAAGR,KAAK,EAAC;KAAc,MAAI,iBAZnG+B,UAAA,E,GAcexB,KAAA,CAAAU,QAAQ,CAACV,KAAA,CAAAC,gBAAgB,K,cAAlCH,mBAAA,CAAkI,KAdxI2B,UAAA,EAc2C,MAAI,GAAArB,gBAAA,CAAGJ,KAAA,CAAAK,WAAW,CAACL,KAAA,CAAAC,gBAAgB,KAAI,UAAQ,GAAAG,gBAAA,CAAGJ,KAAA,CAAA0B,kBAAkB,CAAC1B,KAAA,CAAAC,gBAAgB,qBAdhIE,mBAAA,e,KAAAA,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}